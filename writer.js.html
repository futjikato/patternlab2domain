<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: writer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: writer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module patternlab2domain
 * @author Moritz Spindelhirn [m.spindelhirn@cashiers-check.de]
 * @namespace Writer
 */
(function(module) {
    'use strict';

    var extend = require('extend'),
        fs = require('fs');

    /**
     * Writer default options
     *
     * @memberOf Writer
     *
     * @type {{outFile: string, pretty: number}}
     */
    var writerDefaultOptions = {

        outFile: '/home/moritz/node/patternlab2phpcr/out/model.json',

        pretty: 4
    };

    /**
     * Writer class for creating the actual model json file.
     *
     * @memberOf Writer
     * @namespace Writer.Writer
     *
     * @param {{}} options
     * @constructor
     */
    function Writer(options) {

        /**
         * Writer options
         *
         * @memberOf Writer.Writer
         * @name options
         *
         * @type {{}}
         */
        this.options = extend({}, writerDefaultOptions, options);

        /**
         * Domain model
         *
         * @memberOf Writer.Writer
         * @name model
         *
         * @type {{}}
         */
        this.model = {
            elements: []
        };

        /**
         * Add a CrNode to the model.
         * Checks if the node is an element and not just a simple include.
         *
         * @memberOf Writer.Writer
         * @function addNodeToModel
         * @private
         *
         * @param {Builder.CrNode} crNode
         */
        this.addNodeToModel = function(crNode) {
            if(!crNode.info.hasOwnProperty('isOwnElement') || crNode.info.isOwnElement !== false) {
                this.model.elements.push(crNode);
            }
        }
    }

    /**
     * Convert the node storage to the domain model.
     * Then write the model to a file.
     *
     * @memberOf Writer.Writer
     * @function write
     *
     * @param {Builder.NodeStorage} storage
     * @param {function} fn
     */
    Writer.prototype.write = function(storage, fn) {
        if(typeof fn != 'function') {
            fn = function() {};
        }

        for(var i in storage) {
            if(storage.hasOwnProperty(i)) {
                this.addNodeToModel(storage[i]);
            }
        }

        try {
            var str = JSON.stringify(this.model, null, this.options.pretty);
            fs.writeFile(this.options.outFile, str, function(err) {
                fn(err);
            });
        } catch (e) {
            console.log(e);
        }
    };

    // expose writer as public API
    module.exports = {
        Writer: Writer
    };
})(module);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Builder.CrNode.html">CrNode</a></li><li><a href="Builder.NodeStorage.html">NodeStorage</a></li><li><a href="Conductor.Conductor.html">Conductor</a></li><li><a href="Parser.Field.html">Field</a></li><li><a href="Parser.Include.html">Include</a></li><li><a href="Parser.Parser.html">Parser</a></li><li><a href="Writer.Writer.html">Writer</a></li></ul><h3>Namespaces</h3><ul><li><a href="Builder.html">Builder</a></li><li><a href="Conductor.html">Conductor</a></li><li><a href="Conductor.defaultOptions.html">defaultOptions</a></li><li><a href="Parser.html">Parser</a></li><li><a href="Parser.parserFieldDefaultOptions.html">parserFieldDefaultOptions</a></li><li><a href="Writer.html">Writer</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha10</a> on Wed Nov 05 2014 23:01:05 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
